<!DOCTYPE html>
<html lang="id">
<head>
    <title>Hazi Local Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; background: #f0f0f0; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .slot-item { background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-avail { background: #dcfce7; color: #166534; }
        .btn-booked { background: #fee2e2; color: #991b1b; }
        .btn-reset { background: #333; color: white; padding: 10px 20px; width: 100%; margin-top: 20px; }
        
        /* Gaya untuk kotak URL */
        .url-box { background: #1e293b; color: #4ade80; padding: 15px; border-radius: 8px; margin-bottom: 20px; word-break: break-all; font-family: monospace; border: 1px solid #334155; }
        .url-label { color: #94a3b8; font-size: 0.8em; display: block; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Admin Slot</h1>
        <div id="date-display" style="color: #666;"></div>
    </div>

    <div class="url-box">
        <span class="url-label">PUBLIC URL (Copy ke Vercel):</span>
        <div id="cf-url">Loading URL...</div>
    </div>

    <div id="slots-list">Loading...</div>
    <button class="btn btn-reset" onclick="resetSlots()">RESET SEMUA SLOT</button>

    <script>
        const API = 'http://localhost:3000'; // Sesuaikan jika perlu, atau gunakan relatif path jika dibuka lgsg

        async function getTunnelUrl() {
            try {
                // Panggil API baru yang kita buat di server.js
                const res = await fetch('/tunnel-url');
                const data = await res.json();
                document.getElementById('cf-url').innerText = data.url;
            } catch (e) {
                document.getElementById('cf-url').innerText = "Gagal ambil URL";
            }
        }

        async function refresh() {
            const res = await fetch(`/slots`);
            const data = await res.json();
            document.getElementById('date-display').innerText = data.date;
            
            const container = document.getElementById('slots-list');
            container.innerHTML = '';
            const times = ["10:00", "11:00", "12:00", "13:00", "14:00"];

            times.forEach(time => {
                const status = data.slots[time];
                const el = document.createElement('div');
                el.className = 'slot-item';
                const nextStatus = status === 'available' ? 'booked' : 'available';
                const btnClass = status === 'available' ? 'btn-avail' : 'btn-booked';
                
                el.innerHTML = `
                    <span style="font-size: 1.2em; font-weight: bold;">${time}</span>
                    <button class="btn ${btnClass}" onclick="toggle('${time}', '${nextStatus}')">
                        ${status.toUpperCase()}
                    </button>
                `;
                container.appendChild(el);
            });
        }

        async function toggle(time, status) {
            await fetch(`/slots`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ time, status })
            });
            refresh();
        }

        async function resetSlots() {
            if(confirm('Reset slot?')) {
                await fetch(`/reset`, { method: 'POST' });
                refresh();
            }
        }

        // Jalankan saat load
        refresh();
        getTunnelUrl();
    </script>
</body>
</html>
