<!DOCTYPE html>
<html lang="id">
<head>
    <title>Hazi Local Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; background: #f0f0f0; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .slot-item { background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-avail { background: #dcfce7; color: #166534; }
        .btn-booked { background: #fee2e2; color: #991b1b; }
        .btn-reset { background: #333; color: white; padding: 10px 20px; width: 100%; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Admin Slot</h1>
        <div id="date-display" style="color: #666;"></div>
    </div>

    <div id="slots-list">Loading...</div>

    <button class="btn btn-reset" onclick="resetSlots()">RESET SEMUA SLOT (HARI INI)</button>

    <script>
        const API = 'http://localhost:3000';

        async function refresh() {
            const res = await fetch(`${API}/slots`);
            const data = await res.json();
            document.getElementById('date-display').innerText = data.date;
            
            const container = document.getElementById('slots-list');
            container.innerHTML = '';

            // Urutan jam
            const times = ["10:00", "11:00", "12:00", "13:00", "14:00"];

            times.forEach(time => {
                const status = data.slots[time];
                const el = document.createElement('div');
                el.className = 'slot-item';
                
                // Toggle Button Logic
                const nextStatus = status === 'available' ? 'booked' : 'available';
                const btnClass = status === 'available' ? 'btn-avail' : 'btn-booked';
                
                el.innerHTML = `
                    <span style="font-size: 1.2em; font-weight: bold;">${time}</span>
                    <button class="btn ${btnClass}" onclick="toggle('${time}', '${nextStatus}')">
                        ${status.toUpperCase()}
                    </button>
                `;
                container.appendChild(el);
            });
        }

        async function toggle(time, status) {
            await fetch(`${API}/slots`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ time, status })
            });
            refresh();
        }

        async function resetSlots() {
            if(confirm('Yakin reset semua slot jadi available?')) {
                await fetch(`${API}/reset`, { method: 'POST' });
                refresh();
            }
        }

        refresh();
    </script>
</body>
</html>

